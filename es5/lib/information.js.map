{"version":3,"sources":["lib/information.js"],"names":[],"mappings":"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","file":"information.js","sourcesContent":["import {GhostKernelRoutings, GhostKernelControllers, GhostKernelController} from 'ghost-kernel';\n\nexport class InformationRouting {\n  setup(routes) {\n    routes.controller('InformationController', (routes) => {\n      routes.event('GhostKernel', 'notify_informations_done', 'initialize_informations');\n      routes.event('GhostKernel', 'halt');\n    });\n  }\n}\n\nexport class InformationController extends GhostKernelController {\n  constructor(kernel) {\n    super(kernel);\n    kernel.registerComponent('Information', new Information());\n  }\n\n  initialize_informations() {\n    const kernel = this.kernel;\n    const Information = kernel.components.Information;\n    const shiorif = kernel.components.Shiorif;\n    Promise.all(\n      [\n        shiorif.request3('GET', 'username').then(({response}) =>\n          Information.username = response.to('3.0').headers.header.Value\n        ),\n      ].concat([\n        'sakura.recommendsites',\n        'sakura.portalsites',\n        'kero.recommendsites',\n      ].map((id) =>\n        shiorif.get3(id).then(({response}) => {\n          Information[id].length = 0; // clear\n          (response.to('3.0').headers.get_separated2('Value') || []).forEach((site) =>\n            Information[id].push(new SiteMenu(...site))\n          );\n        })\n      ))\n    ).then(\n      () => kernel.emit('initialize_informations_done')\n    );\n  }\n\n  halt() {\n    this.kernel.unregisterComponent('Information');\n  }\n}\n\nexport class Information {\n  constructor() {\n    this['_sakura.recommendsites'] = [];\n    this['_sakura.portalsites'] = [];\n    this['_kero.recommendsites'] = [];\n  }\n\n  /**\n   * ユーザー名\n   * @type {string}\n   */\n  get username() { return this._username; }\n  /**\n   * ユーザー名\n   * @type {string}\n   */\n  set username(value) { this._username = value; }\n\n  /**\n   * sakura.recommendsites\n   * @type {SiteMenu[]}\n   */\n  get ['sakura.recommendsites']() { return this['_sakura.recommendsites']; }\n\n  /**\n   * sakura.portalsites\n   * @type {SiteMenu[]}\n   */\n  get ['sakura.portalsites']() { return this['_sakura.portalsites']; }\n\n  /**\n   * kero.recommendsites\n   * @type {SiteMenu[]}\n   */\n  get ['kero.recommendsites']() { return this['_kero.recommendsites']; }\n}\n\nexport class SiteMenu {\n  /**\n   * @param {string} name 項目名\n   * @param {string} url URL\n   * @param {string} banner バナー画像パス\n   * @param {string} script 選択時トークスクリプト\n   */\n  constructor(name, url, banner, script) {\n    this._name = name;\n    this._url = url;\n    this._banner = banner;\n    this._script = script;\n  }\n\n  /**\n   * 項目名\n   * @type {string}\n   */\n  get name() { return this._name; }\n\n  /**\n   * URL\n   * @type {string}\n   */\n  get url() { return this._url; }\n\n  /**\n   * バナー画像パス\n   * @type {string}\n   */\n  get banner() { return this._banner; }\n\n  /**\n   * 選択時トークスクリプト\n   * @type {string}\n   */\n  get script() { return this._script; }\n}\n\nGhostKernelControllers.InformationController = InformationController;\nGhostKernelRoutings.push(InformationRouting);\n"]}